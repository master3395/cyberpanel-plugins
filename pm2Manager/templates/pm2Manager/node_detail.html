{% extends "baseTemplate/index.html" %}
{% load i18n %}
{% load static %}
{% block title %}{% trans "PM2 Node Details - CyberPanel" %}{% endblock %}

{% block header_scripts %}
<style>
    .node-detail { padding: 20px; }
    .detail-header { display: flex; justify-content: space-between; align-items: center; margin-bottom: 30px; padding-bottom: 20px; border-bottom: 2px solid var(--border-primary, #e8e9ff); }
    .detail-title { font-size: 24px; font-weight: 700; color: var(--text-primary, #2f3640); }
    .back-button { padding: 10px 20px; background: #5856d6; color: white; border-radius: 8px; text-decoration: none; display: inline-flex; align-items: center; gap: 8px; }
    .detail-grid { display: grid; grid-template-columns: 1fr 1fr; gap: 20px; margin-bottom: 30px; }
    .detail-card { background: white; padding: 20px; border-radius: 12px; box-shadow: 0 2px 8px rgba(0,0,0,0.1); border: 1px solid var(--border-primary, #e8e9ff); }
    .card-title { font-size: 18px; font-weight: 600; margin-bottom: 15px; color: var(--text-primary, #2f3640); }
    .info-row { display: flex; justify-content: space-between; padding: 10px 0; border-bottom: 1px solid var(--border-primary, #e8e9ff); }
    .info-label { color: var(--text-secondary, #64748b); font-weight: 500; }
    .info-value { color: var(--text-primary, #2f3640); font-weight: 600; }
    .logs-container { background: #1e1e1e; color: #d4d4d4; padding: 15px; border-radius: 8px; font-family: 'Courier New', monospace; font-size: 12px; max-height: 400px; overflow-y: auto; margin-top: 15px; }
    .log-line { margin: 2px 0; white-space: pre-wrap; word-break: break-all; }
    .action-buttons { display: flex; gap: 10px; margin-top: 20px; }
    .action-btn { padding: 8px 16px; border-radius: 6px; border: none; cursor: pointer; font-size: 12px; font-weight: 600; }
    .btn-start { background: #10b981; color: white; }
    .btn-stop { background: #ef4444; color: white; }
    .btn-restart { background: #f59e0b; color: white; }
    .status-badge { display: inline-block; padding: 4px 12px; border-radius: 12px; font-size: 12px; font-weight: 600; text-transform: uppercase; }
    .status-online { background: #d1fae5; color: #065f46; }
    .status-stopped { background: #fee2e2; color: #991b1b; }
    .status-restarting { background: #fef3c7; color: #92400e; }
    @media (max-width: 768px) { .detail-grid { grid-template-columns: 1fr; } }
</style>
{% endblock %}

{% block content %}
<div class="node-detail">
    <div class="detail-header">
        <div>
            <a href="/plugins/pm2Manager/" class="back-button">
                <i class="fas fa-arrow-left"></i>
                {% trans "Back to Dashboard" %}
            </a>
            <h1 class="detail-title" style="margin-top: 15px;">
                <i class="fas fa-server"></i>
                {{ app_name }}
            </h1>
        </div>
        <div class="action-buttons">
            <button class="action-btn btn-start" onclick="startApp('{{ app_name }}')" id="btnStart" style="display: none;">
                <i class="fas fa-play"></i> Start
            </button>
            <button class="action-btn btn-stop" onclick="stopApp('{{ app_name }}')" id="btnStop" style="display: none;">
                <i class="fas fa-stop"></i> Stop
            </button>
            <button class="action-btn btn-restart" onclick="restartApp('{{ app_name }}')" id="btnRestart" style="display: none;">
                <i class="fas fa-redo"></i> Restart
            </button>
        </div>
    </div>
    
    <div class="detail-grid">
        <div class="detail-card">
            <h3 class="card-title">
                <i class="fas fa-info-circle"></i>
                {% trans "Application Information" %}
            </h3>
            <div id="appInfo">
                <div class="info-row">
                    <span class="info-label">{% trans "Loading..." %}</span>
                    <span class="info-value"></span>
                </div>
            </div>
        </div>
        
        <div class="detail-card">
            <h3 class="card-title">
                <i class="fas fa-chart-line"></i>
                {% trans "Resource Usage" %}
            </h3>
            <div id="resourceUsage">
                <div class="info-row">
                    <span class="info-label">{% trans "Loading..." %}</span>
                    <span class="info-value"></span>
                </div>
            </div>
        </div>
    </div>
    
    <div class="detail-card">
        <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 15px;">
            <h3 class="card-title" style="margin: 0;">
                <i class="fas fa-file-alt"></i>
                {% trans "Application Logs" %}
            </h3>
            <button onclick="refreshLogs()" style="padding: 8px 16px; background: #5856d6; color: white; border: none; border-radius: 6px; cursor: pointer;">
                <i class="fas fa-sync-alt"></i> Refresh
            </button>
        </div>
        <div class="logs-container" id="logsContainer">
            <div class="log-line">{% trans "Loading logs..." %}</div>
        </div>
    </div>
</div>

<script src="{% static 'pm2Manager/js/node_detail.js' %}"></script>
<script>
    const appName = '{{ app_name|escapejs }}';
</script>
{% endblock %}
